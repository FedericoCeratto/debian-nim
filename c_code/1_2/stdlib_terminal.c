/* Generated by Nim Compiler v0.14.0 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <string.h>
#include <stdio.h>
#include <io.h>
typedef struct TGenericSeq TGenericSeq;
typedef struct NimStringDesc NimStringDesc;
typedef struct Consolescreenbufferinfo182018 Consolescreenbufferinfo182018;
typedef struct Coord182014 Coord182014;
typedef struct Smallrect182016 Smallrect182016;
typedef N_STDCALL_PTR(NI, TY112821) (NI32 nstdhandle0);
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_STDCALL_PTR(NI32, TY182031) (NI hsourceprocesshandle0, NI hsourcehandle0, NI htargetprocesshandle0, NI* lptargethandle0, NI32 dwdesiredaccess0, NI32 binherithandle0, NI32 dwoptions0);
typedef N_STDCALL_PTR(NI, TY182041) (void);
struct  Coord182014  {
NI16 X;
NI16 Y;
};
struct  Smallrect182016  {
NI16 Left;
NI16 Top;
NI16 Right;
NI16 Bottom;
};
struct  Consolescreenbufferinfo182018  {
Coord182014 dwsize;
Coord182014 dwcursorposition;
NI16 wattributes;
Smallrect182016 srwindow;
Coord182014 dwmaximumwindowsize;
};
typedef N_STDCALL_PTR(NI32, TY182043) (NI hconsoleoutput0, Consolescreenbufferinfo182018* lpconsolescreenbufferinfo0);
typedef NU8 Style185013Set;
typedef NU8 Style185013;
typedef N_STDCALL_PTR(NI32, TY182068) (NI hconsoleoutput0, NI16 wattributes0);
typedef NU8 Foregroundcolor185605;
typedef NI TY185818[8];
N_NIMCALL(void*, nimLoadLibrary)(NimStringDesc* path0);
N_NOINLINE(void, nimLoadLibraryError)(NimStringDesc* path0);
N_NIMCALL(void*, nimGetProcAddr)(void* lib0, NCSTRING name0);
N_NIMCALL(NI16, getattributes_182421_4182131368)(NI h0);
STRING_LITERAL(TMP179, "kernel32", 8);
STRING_LITERAL(TMP180, "kernel32", 8);
NIM_CONST TY185818 lookup_185815_4182131368 = {((NI) 0),
((NI) 4),
((NI) 2),
((NI) 6),
((NI) 1),
((NI) 5),
((NI) 3),
((NI) 7)}
;
NI hstdout_182071_4182131368;
NI hstderr_182072_4182131368;
NI hstdouttemp_182073_4182131368;
extern TY112821 Dl_112820;
static void* TMP178;
TY182031 Dl_182030;
TY182041 Dl_182040;
NI hstderrtemp_182201_4182131368;
NI16 oldstdoutattr_182428_4182131368;
TY182043 Dl_182042;
NI16 oldstderrattr_182429_4182131368;
TY182068 Dl_182067;

N_NIMCALL(NI16, getattributes_182421_4182131368)(NI h0) {
	NI16 result0;
	Consolescreenbufferinfo182018 c0;
{	result0 = (NI16)0;
	memset((void*)(&c0), 0, sizeof(c0));
	{
		NI32 LOC3;
		LOC3 = (NI32)0;
		LOC3 = Dl_182042(h0, (&c0));
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		result0 = c0.wattributes;
		goto BeforeRet;
	}
	LA4: ;
	result0 = ((NI16) 112);
	goto BeforeRet;
	}BeforeRet: ;
	return result0;
}

N_NIMCALL(void, setstyle_185201_4182131368)(FILE* f0, Style185013Set style0) {
	NI h0;
	NI16 a0;
	NI32 LOC22;
	{
		if (!(f0 == stderr)) goto LA3;
		h0 = hstderr_182072_4182131368;
	}
	goto LA1;
	LA3: ;
	{
		h0 = hstdout_182071_4182131368;
	}
	LA1: ;
	a0 = ((NI16) 0);
	{
		if (!((style0 &(1U<<((NU)((((Style185013) 1)- 1))&7U)))!=0)) goto LA8;
		a0 = (NI16)(a0 | ((NI16) 8));
	}
	LA8: ;
	{
		if (!((style0 &(1U<<((NU)((((Style185013) 5)- 1))&7U)))!=0)) goto LA12;
		a0 = (NI16)(a0 | ((NI16) 128));
	}
	LA12: ;
	{
		if (!((style0 &(1U<<((NU)((((Style185013) 7)- 1))&7U)))!=0)) goto LA16;
		a0 = (NI16)(a0 | ((NI16) 16384));
	}
	LA16: ;
	{
		if (!((style0 &(1U<<((NU)((((Style185013) 4)- 1))&7U)))!=0)) goto LA20;
		a0 = (NI16)(a0 | ((NI16) -32768));
	}
	LA20: ;
	LOC22 = (NI32)0;
	LOC22 = Dl_182067(h0, a0);
}

N_NIMCALL(void, resetattributes_184825_4182131368)(FILE* f0) {
	{
		NI32 LOC5;
		if (!(f0 == stderr)) goto LA3;
		LOC5 = (NI32)0;
		LOC5 = Dl_182067(hstderr_182072_4182131368, oldstderrattr_182429_4182131368);
	}
	goto LA1;
	LA3: ;
	{
		NI32 LOC7;
		LOC7 = (NI32)0;
		LOC7 = Dl_182067(hstdout_182071_4182131368, oldstdoutattr_182428_4182131368);
	}
	LA1: ;
}

N_NIMCALL(void, setforegroundcolor_185627_4182131368)(FILE* f0, Foregroundcolor185605 fg0, NIM_BOOL bright0) {
	NI h0;
	NI16 old0;
	NI16 LOC6;
	NI32 LOC11;
	{
		if (!(f0 == stderr)) goto LA3;
		h0 = hstderr_182072_4182131368;
	}
	goto LA1;
	LA3: ;
	{
		h0 = hstdout_182071_4182131368;
	}
	LA1: ;
	LOC6 = (NI16)0;
	LOC6 = getattributes_182421_4182131368(h0);
	old0 = (NI16)(LOC6 & ((NI16) -8));
	{
		if (!bright0) goto LA9;
		old0 = (NI16)(old0 | ((NI16) 8));
	}
	LA9: ;
	LOC11 = (NI32)0;
	LOC11 = Dl_182067(h0, ((NI16)(NU16)(NU)((NI)(((NI) (old0)) | lookup_185815_4182131368[(fg0)- 30]))));
}

N_NIMCALL(NIM_BOOL, isatty_186025_4182131368)(FILE* f0) {
	NIM_BOOL result0;
	int LOC1;
	int LOC2;
	result0 = (NIM_BOOL)0;
	LOC1 = (int)0;
	LOC1 = fileno(f0);
	LOC2 = (int)0;
	LOC2 = _isatty(LOC1);
	result0 = !((LOC2 == ((NI32) 0)));
	return result0;
}
NIM_EXTERNC N_NOINLINE(void, stdlib_terminalInit000)(void) {
	{
		hstdouttemp_182073_4182131368 = Dl_112820(((NI32) -11));
		{
			NI LOC4;
			NI LOC5;
			NI32 LOC6;
			LOC4 = (NI)0;
			LOC4 = Dl_182040();
			LOC5 = (NI)0;
			LOC5 = Dl_182040();
			LOC6 = (NI32)0;
			LOC6 = Dl_182030(LOC4, hstdouttemp_182073_4182131368, LOC5, (&hstdout_182071_4182131368), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC6 == ((NI32) 0))) goto LA7;
		}
		LA7: ;
		hstderrtemp_182201_4182131368 = Dl_112820(((NI32) -12));
		{
			NI LOC11;
			NI LOC12;
			NI32 LOC13;
			LOC11 = (NI)0;
			LOC11 = Dl_182040();
			LOC12 = (NI)0;
			LOC12 = Dl_182040();
			LOC13 = (NI32)0;
			LOC13 = Dl_182030(LOC11, hstderrtemp_182201_4182131368, LOC12, (&hstderr_182072_4182131368), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC13 == ((NI32) 0))) goto LA14;
		}
		LA14: ;
	}
	oldstdoutattr_182428_4182131368 = getattributes_182421_4182131368(hstdout_182071_4182131368);
	oldstderrattr_182429_4182131368 = getattributes_182421_4182131368(hstderr_182072_4182131368);
}

NIM_EXTERNC N_NOINLINE(void, stdlib_terminalDatInit000)(void) {
if (!((TMP178 = nimLoadLibrary((NimStringDesc*) &TMP179))
)) nimLoadLibraryError((NimStringDesc*) &TMP180);
	Dl_182030 = (TY182031) nimGetProcAddr(TMP178, "DuplicateHandle");
	Dl_182040 = (TY182041) nimGetProcAddr(TMP178, "GetCurrentProcess");
	Dl_182042 = (TY182043) nimGetProcAddr(TMP178, "GetConsoleScreenBufferInfo");
	Dl_182067 = (TY182068) nimGetProcAddr(TMP178, "SetConsoleTextAttribute");
}

