/* Generated by Nim Compiler v0.13.0 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
/* Compiled for: Linux, amd64, gcc */
/* Command for C compiler:
   gcc -c  -w -O3 -fno-strict-aliasing  -I/home/ubuntu/nim-ci/Nim/lib -o /home/ubuntu/nim-ci/Nim/compiler/rnimcache/stdlib_lexbase.o /home/ubuntu/nim-ci/Nim/compiler/rnimcache/stdlib_lexbase.c */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <string.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct Baselexer219009 Baselexer219009;
typedef struct TNimObject TNimObject;
typedef struct Streamobj156818 Streamobj156818;
typedef N_NIMCALL_PTR(void, TY3489) (void* p, NI op);
typedef N_NIMCALL_PTR(void*, TY3494) (void* p);
struct  TNimType  {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY3489 marker;
TY3494 deepcopy;
};
struct  TNimNode  {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct  TNimObject  {
TNimType* m_type;
};
typedef NU8 TY283404[32];
struct  Baselexer219009  {
  TNimObject Sup;
NI bufpos;
NCSTRING buf;
NI buflen;
Streamobj156818* input;
NI linenumber;
NI sentinel;
NI linestart;
TY283404 refillchars;
};
typedef N_NIMCALL_PTR(void, TY156819) (Streamobj156818* s);
typedef N_NIMCALL_PTR(NIM_BOOL, TY156823) (Streamobj156818* s);
typedef N_NIMCALL_PTR(void, TY156827) (Streamobj156818* s, NI pos);
typedef N_NIMCALL_PTR(NI, TY156832) (Streamobj156818* s);
typedef N_NIMCALL_PTR(NI, TY156836) (Streamobj156818* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(NI, TY156842) (Streamobj156818* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(void, TY156848) (Streamobj156818* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(void, TY156854) (Streamobj156818* s);
struct  Streamobj156818  {
  TNimObject Sup;
TY156819 closeimpl;
TY156823 atendimpl;
TY156827 setpositionimpl;
TY156832 getpositionimpl;
TY156836 readdataimpl;
TY156842 peekdataimpl;
TY156848 writedataimpl;
TY156854 flushimpl;
};
N_NIMCALL(void, unsureAsgnRef)(void** dest, void* src);
N_NOCONV(void*, alloc_7801)(NI size);
N_NIMCALL(void, fillbuffer_219201)(Baselexer219009* L);
static N_INLINE(void, movemem_7483)(void* dest, void* source, NI size);
N_NIMCALL(NI, readdata_156911)(Streamobj156818* s, void* buffer, NI buflen);
N_NOCONV(void*, realloc_7833)(void* p, NI newsize);
N_NIMCALL(void, skiputf8bom_221201)(Baselexer219009* L);
N_NOCONV(void, dealloc_7848)(void* p);
N_NIMCALL(void, close_156870)(Streamobj156818* s);
N_NIMCALL(NI, fillbaselexer_220409)(Baselexer219009* L, NI pos);
extern TNimType NTI3608; /* RootObj */
TNimType NTI219009; /* BaseLexer */
extern TNimType NTI104; /* int */
extern TNimType NTI140; /* cstring */
extern TNimType NTI156816; /* Stream */
extern TNimType NTI283404; /* set[char] */

static N_INLINE(void, movemem_7483)(void* dest, void* source, NI size) {
	void* LOC1;
	LOC1 = 0;
	LOC1 = memmove(dest, source, ((size_t) (size)));
}

N_NIMCALL(void, fillbuffer_219201)(Baselexer219009* L) {
	NI charsread;
	NI tocopy;
	NI s;
	NI oldbuflen;
	NI LOC5;
	charsread = 0;
	tocopy = 0;
	s = 0;
	oldbuflen = 0;
	tocopy = (NI)((NI)((*L).buflen - (*L).sentinel) - ((NI) 1));
	{
		if (!(((NI) 0) < tocopy)) goto LA3;
		movemem_7483(((void*) ((*L).buf)), ((void*) ((&(*L).buf[(NI)((*L).sentinel + ((NI) 1))]))), ((NI) ((NI)(tocopy * ((NI) 1)))));
	}
	LA3: ;
	LOC5 = 0;
	LOC5 = readdata_156911((*L).input, ((void*) ((&(*L).buf[tocopy]))), (NI)((NI)((*L).sentinel + ((NI) 1)) * ((NI) 1)));
	charsread = (NI)(LOC5 / ((NI) 1));
	s = (NI)(tocopy + charsread);
	{
		if (!(charsread < (NI)((*L).sentinel + ((NI) 1)))) goto LA8;
		(*L).buf[s] = 0;
		(*L).sentinel = s;
	}
	goto LA6;
	LA8: ;
	{
		s -= ((NI) 1);
		{
			while (1) {
				{
					while (1) {
						NIM_BOOL LOC15;
						LOC15 = 0;
						LOC15 = (((NI) 0) <= s);
						if (!(LOC15)) goto LA16;
						LOC15 = !((((*L).refillchars[(NU)(((NU8)((*L).buf[s])))>>3] &(1U<<((NU)(((NU8)((*L).buf[s])))&7U)))!=0));
						LA16: ;
						if (!LOC15) goto LA14;
						s -= ((NI) 1);
					} LA14: ;
				}
				{
					if (!(((NI) 0) <= s)) goto LA19;
					(*L).sentinel = s;
					goto LA11;
				}
				goto LA17;
				LA19: ;
				{
					void* LOC22;
					NI LOC23;
					oldbuflen = (*L).buflen;
					(*L).buflen = (NI)((*L).buflen * ((NI) 2));
					LOC22 = 0;
					LOC22 = realloc_7833(((void*) ((*L).buf)), ((NI) ((NI)((*L).buflen * ((NI) 1)))));
					(*L).buf = ((NCSTRING) (LOC22));
					LOC23 = 0;
					LOC23 = readdata_156911((*L).input, ((void*) ((&(*L).buf[oldbuflen]))), (NI)(oldbuflen * ((NI) 1)));
					charsread = (NI)(LOC23 / ((NI) 1));
					{
						if (!(charsread < oldbuflen)) goto LA26;
						(*L).buf[(NI)(oldbuflen + charsread)] = 0;
						(*L).sentinel = (NI)(oldbuflen + charsread);
						goto LA11;
					}
					LA26: ;
					s = (NI)((*L).buflen - ((NI) 1));
				}
				LA17: ;
			}
		} LA11: ;
	}
	LA6: ;
}

N_NIMCALL(void, skiputf8bom_221201)(Baselexer219009* L) {
	{
		NIM_BOOL LOC3;
		NIM_BOOL LOC4;
		LOC3 = 0;
		LOC4 = 0;
		LOC4 = ((NU8)((*L).buf[((NI) 0)]) == (NU8)(239));
		if (!(LOC4)) goto LA5;
		LOC4 = ((NU8)((*L).buf[((NI) 1)]) == (NU8)(187));
		LA5: ;
		LOC3 = LOC4;
		if (!(LOC3)) goto LA6;
		LOC3 = ((NU8)((*L).buf[((NI) 2)]) == (NU8)(191));
		LA6: ;
		if (!LOC3) goto LA7;
		(*L).bufpos += ((NI) 3);
		(*L).linestart += ((NI) 3);
	}
	LA7: ;
}

N_NIMCALL(void, open_221223)(Baselexer219009* L, Streamobj156818* input, NI buflen, TY283404 refillchars) {
	void* LOC1;
	unsureAsgnRef((void**) (&(*L).input), input);
	(*L).bufpos = ((NI) 0);
	(*L).buflen = buflen;
	memcpy((void*)(*L).refillchars, (NIM_CONST void*)refillchars, 32);
	LOC1 = 0;
	LOC1 = alloc_7801(((NI) ((NI)(buflen * ((NI) 1)))));
	(*L).buf = ((NCSTRING) (LOC1));
	(*L).sentinel = (NI)(buflen - ((NI) 1));
	(*L).linestart = ((NI) 0);
	(*L).linenumber = ((NI) 1);
	fillbuffer_219201(L);
	skiputf8bom_221201(L);
}

N_NIMCALL(void, close_219022)(Baselexer219009* L) {
	dealloc_7848(((void*) ((*L).buf)));
	close_156870((*L).input);
}

N_NIMCALL(NI, fillbaselexer_220409)(Baselexer219009* L, NI pos) {
	NI result;
	result = 0;
	{
		if (!(pos < (*L).sentinel)) goto LA3;
		result = (NI)(pos + ((NI) 1));
	}
	goto LA1;
	LA3: ;
	{
		fillbuffer_219201(L);
		(*L).bufpos = ((NI) 0);
		result = ((NI) 0);
	}
	LA1: ;
	return result;
}

N_NIMCALL(NI, handlecr_220601)(Baselexer219009* L, NI pos) {
	NI result;
	result = 0;
	(*L).linenumber += ((NI) 1);
	result = fillbaselexer_220409(L, pos);
	{
		if (!((NU8)((*L).buf[result]) == (NU8)(10))) goto LA3;
		result = fillbaselexer_220409(L, result);
	}
	LA3: ;
	(*L).linestart = result;
	return result;
}

N_NIMCALL(NI, handlelf_220810)(Baselexer219009* L, NI pos) {
	NI result;
	result = 0;
	(*L).linenumber += ((NI) 1);
	result = fillbaselexer_220409(L, pos);
	(*L).linestart = result;
	return result;
}

N_NIMCALL(NI, getcolnumber_221802)(Baselexer219009* L, NI pos) {
	NI result;
	result = 0;
	result = ((NI)(pos - (*L).linestart) > 0? ((NI)(pos - (*L).linestart)) : -((NI)(pos - (*L).linestart)));
	return result;
}
NIM_EXTERNC N_NOINLINE(void, stdlib_lexbaseInit000)(void) {
}

NIM_EXTERNC N_NOINLINE(void, stdlib_lexbaseDatInit000)(void) {
static TNimNode* TMP2873[8];
static TNimNode TMP537[9];
NTI219009.size = sizeof(Baselexer219009);
NTI219009.kind = 17;
NTI219009.base = (&NTI3608);
TMP2873[0] = &TMP537[1];
TMP537[1].kind = 1;
TMP537[1].offset = offsetof(Baselexer219009, bufpos);
TMP537[1].typ = (&NTI104);
TMP537[1].name = "bufpos";
TMP2873[1] = &TMP537[2];
TMP537[2].kind = 1;
TMP537[2].offset = offsetof(Baselexer219009, buf);
TMP537[2].typ = (&NTI140);
TMP537[2].name = "buf";
TMP2873[2] = &TMP537[3];
TMP537[3].kind = 1;
TMP537[3].offset = offsetof(Baselexer219009, buflen);
TMP537[3].typ = (&NTI104);
TMP537[3].name = "bufLen";
TMP2873[3] = &TMP537[4];
TMP537[4].kind = 1;
TMP537[4].offset = offsetof(Baselexer219009, input);
TMP537[4].typ = (&NTI156816);
TMP537[4].name = "input";
TMP2873[4] = &TMP537[5];
TMP537[5].kind = 1;
TMP537[5].offset = offsetof(Baselexer219009, linenumber);
TMP537[5].typ = (&NTI104);
TMP537[5].name = "lineNumber";
TMP2873[5] = &TMP537[6];
TMP537[6].kind = 1;
TMP537[6].offset = offsetof(Baselexer219009, sentinel);
TMP537[6].typ = (&NTI104);
TMP537[6].name = "sentinel";
TMP2873[6] = &TMP537[7];
TMP537[7].kind = 1;
TMP537[7].offset = offsetof(Baselexer219009, linestart);
TMP537[7].typ = (&NTI104);
TMP537[7].name = "lineStart";
TMP2873[7] = &TMP537[8];
TMP537[8].kind = 1;
TMP537[8].offset = offsetof(Baselexer219009, refillchars);
TMP537[8].typ = (&NTI283404);
TMP537[8].name = "refillChars";
TMP537[0].len = 8; TMP537[0].kind = 2; TMP537[0].sons = &TMP2873[0];
NTI219009.node = &TMP537[0];
}

