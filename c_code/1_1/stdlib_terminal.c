/* Generated by Nim Compiler v0.12.0 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 32

#include "nimbase.h"
#include <string.h>
#include <stdio.h>
#include <io.h>
typedef struct TGenericSeq TGenericSeq;
typedef struct NimStringDesc NimStringDesc;
typedef struct Consolescreenbufferinfo186021 Consolescreenbufferinfo186021;
typedef struct Coord186017 Coord186017;
typedef struct Smallrect186019 Smallrect186019;
typedef N_STDCALL_PTR(NI, TY111639) (NI32 nstdhandle);
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_STDCALL_PTR(NI32, TY186034) (NI hsourceprocesshandle, NI hsourcehandle, NI htargetprocesshandle, NI* lptargethandle, NI32 dwdesiredaccess, NI32 binherithandle, NI32 dwoptions);
typedef N_STDCALL_PTR(NI, TY186044) (void);
struct  Coord186017  {
NI16 X;
NI16 Y;
};
struct  Smallrect186019  {
NI16 Left;
NI16 Top;
NI16 Right;
NI16 Bottom;
};
struct  Consolescreenbufferinfo186021  {
Coord186017 dwsize;
Coord186017 dwcursorposition;
NI16 wattributes;
Smallrect186019 srwindow;
Coord186017 dwmaximumwindowsize;
};
typedef N_STDCALL_PTR(NI32, TY186046) (NI hconsoleoutput, Consolescreenbufferinfo186021* lpconsolescreenbufferinfo);
typedef N_STDCALL_PTR(NI32, TY186071) (NI hconsoleoutput, NI16 wattributes);
typedef NI TY189818[8];
N_NIMCALL(void*, nimLoadLibrary)(NimStringDesc* path);
N_NOINLINE(void, nimLoadLibraryError)(NimStringDesc* path);
N_NIMCALL(void*, nimGetProcAddr)(void* lib, NCSTRING name);
N_NIMCALL(NI16, getattributes_186427)(NI h);
STRING_LITERAL(TMP145, "kernel32", 8);
STRING_LITERAL(TMP146, "kernel32", 8);
NIM_CONST TY189818 lookup_189815 = {((NI) 0),
((NI) 4),
((NI) 2),
((NI) 6),
((NI) 1),
((NI) 5),
((NI) 3),
((NI) 7)}
;
NI hstdout_186074;
NI hstderr_186075;
extern TY111639 Dl_111638;
static void* TMP144;
TY186034 Dl_186033;
TY186044 Dl_186043;
NI16 oldstdoutattr_186437;
TY186046 Dl_186045;
NI16 oldstderrattr_186438;
TY186071 Dl_186070;

N_NIMCALL(NI16, getattributes_186427)(NI h) {
	NI16 result;
	Consolescreenbufferinfo186021 c;
{	result = 0;
	memset((void*)(&c), 0, sizeof(c));
	{
		NI32 LOC3;
		LOC3 = 0;
		LOC3 = Dl_186045(h, (&c));
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		result = c.wattributes;
		goto BeforeRet;
	}
	LA4: ;
	result = ((NI16) 112);
	goto BeforeRet;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(void, setstyle_189201)(FILE* f, NU8 style) {
	NI h;
	NI16 a;
	NI32 LOC22;
	{
		if (!(f == stderr)) goto LA3;
		h = hstderr_186075;
	}
	goto LA1;
	LA3: ;
	{
		h = hstdout_186074;
	}
	LA1: ;
	a = ((NI16) 0);
	{
		if (!((style &(1<<(((((NU8) 1)- 1))&7)))!=0)) goto LA8;
		a = (NI16)(a | ((NI16) 8));
	}
	LA8: ;
	{
		if (!((style &(1<<(((((NU8) 5)- 1))&7)))!=0)) goto LA12;
		a = (NI16)(a | ((NI16) 128));
	}
	LA12: ;
	{
		if (!((style &(1<<(((((NU8) 7)- 1))&7)))!=0)) goto LA16;
		a = (NI16)(a | ((NI16) 16384));
	}
	LA16: ;
	{
		if (!((style &(1<<(((((NU8) 4)- 1))&7)))!=0)) goto LA20;
		a = (NI16)(a | ((NI16) -32768));
	}
	LA20: ;
	LOC22 = 0;
	LOC22 = Dl_186070(h, a);
}

N_NIMCALL(void, resetattributes_188831)(FILE* f) {
	{
		NI32 LOC5;
		if (!(f == stderr)) goto LA3;
		LOC5 = 0;
		LOC5 = Dl_186070(hstderr_186075, oldstderrattr_186438);
	}
	goto LA1;
	LA3: ;
	{
		NI32 LOC7;
		LOC7 = 0;
		LOC7 = Dl_186070(hstdout_186074, oldstdoutattr_186437);
	}
	LA1: ;
}

N_NIMCALL(void, setforegroundcolor_189639)(FILE* f, NU8 fg, NIM_BOOL bright) {
	NI h;
	NI16 old;
	NI16 LOC6;
	NI32 LOC11;
	{
		if (!(f == stderr)) goto LA3;
		h = hstderr_186075;
	}
	goto LA1;
	LA3: ;
	{
		h = hstdout_186074;
	}
	LA1: ;
	LOC6 = 0;
	LOC6 = getattributes_186427(h);
	old = (NI16)(LOC6 & ((NI16) -8));
	{
		if (!bright) goto LA9;
		old = (NI16)(old | ((NI16) 8));
	}
	LA9: ;
	LOC11 = 0;
	LOC11 = Dl_186070(h, ((NI16)(NU16)(NU)((NI)(((NI) (old)) | lookup_189815[(fg)- 30]))));
}

N_NIMCALL(NIM_BOOL, isatty_190031)(FILE* f) {
	NIM_BOOL result;
	int LOC1;
	int LOC2;
	result = 0;
	LOC1 = 0;
	LOC1 = fileno(f);
	LOC2 = 0;
	LOC2 = _isatty(LOC1);
	result = !((LOC2 == ((NI32) 0)));
	return result;
}
NIM_EXTERNC N_NOINLINE(void, stdlib_terminalInit000)(void) {
	{
		NI hstdouttemp;
		NI hstderrtemp;
		hstdouttemp = Dl_111638(((NI32) -11));
		{
			NI LOC4;
			NI LOC5;
			NI32 LOC6;
			LOC4 = 0;
			LOC4 = Dl_186043();
			LOC5 = 0;
			LOC5 = Dl_186043();
			LOC6 = 0;
			LOC6 = Dl_186033(LOC4, hstdouttemp, LOC5, (&hstdout_186074), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC6 == ((NI32) 0))) goto LA7;
		}
		LA7: ;
		hstderrtemp = Dl_111638(((NI32) -12));
		{
			NI LOC11;
			NI LOC12;
			NI32 LOC13;
			LOC11 = 0;
			LOC11 = Dl_186043();
			LOC12 = 0;
			LOC12 = Dl_186043();
			LOC13 = 0;
			LOC13 = Dl_186033(LOC11, hstderrtemp, LOC12, (&hstderr_186075), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC13 == ((NI32) 0))) goto LA14;
		}
		LA14: ;
	}
	oldstdoutattr_186437 = getattributes_186427(hstdout_186074);
	oldstderrattr_186438 = getattributes_186427(hstderr_186075);
}

NIM_EXTERNC N_NOINLINE(void, stdlib_terminalDatInit000)(void) {
if (!((TMP144 = nimLoadLibrary((NimStringDesc*) &TMP145))
)) nimLoadLibraryError((NimStringDesc*) &TMP146);
	Dl_186033 = (TY186034) nimGetProcAddr(TMP144, "DuplicateHandle");
	Dl_186043 = (TY186044) nimGetProcAddr(TMP144, "GetCurrentProcess");
	Dl_186045 = (TY186046) nimGetProcAddr(TMP144, "GetConsoleScreenBufferInfo");
	Dl_186070 = (TY186071) nimGetProcAddr(TMP144, "SetConsoleTextAttribute");
}

