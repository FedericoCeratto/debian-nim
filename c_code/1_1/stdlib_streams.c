/* Generated by Nim Compiler v0.14.0 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 32

#include "nimbase.h"
#include <stdio.h>
#include <setjmp.h>
#include <string.h>
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct Streamobj154418 Streamobj154418;
typedef struct TNimObject TNimObject;
typedef struct Filestreamobj155477 Filestreamobj155477;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct Exception Exception;
typedef struct TSafePoint TSafePoint;
typedef struct Ioerror3428 Ioerror3428;
typedef struct Systemerror3426 Systemerror3426;
typedef struct Cell47704 Cell47704;
typedef struct Cellseq47720 Cellseq47720;
typedef struct Gcheap50218 Gcheap50218;
typedef struct Gcstack50216 Gcstack50216;
typedef struct Memregion29885 Memregion29885;
typedef struct Smallchunk29839 Smallchunk29839;
typedef struct Llchunk29879 Llchunk29879;
typedef struct Bigchunk29841 Bigchunk29841;
typedef struct Intset29814 Intset29814;
typedef struct Trunk29810 Trunk29810;
typedef struct Avlnode29883 Avlnode29883;
typedef struct Gcstat50214 Gcstat50214;
typedef struct Cellset47716 Cellset47716;
typedef struct Pagedesc47712 Pagedesc47712;
typedef struct Stringstreamobj155377 Stringstreamobj155377;
typedef struct Basechunk29837 Basechunk29837;
typedef struct Freecell29829 Freecell29829;
typedef NU8 Tnimkind3203;
typedef NU8 Tnimtypeflag3209Set;
typedef N_NIMCALL_PTR(void, TY3289) (void* p0, NI op0);
typedef N_NIMCALL_PTR(void*, TY3294) (void* p0);
struct  TNimType  {
NI size;
Tnimkind3203 kind;
Tnimtypeflag3209Set flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY3289 marker;
TY3294 deepcopy;
};
typedef NU8 Tnimnodekind3205;
struct  TNimNode  {
Tnimnodekind3205 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct  TNimObject  {
TNimType* m_type;
};
typedef N_NIMCALL_PTR(void, TY154419) (Streamobj154418* s0);
typedef N_NIMCALL_PTR(NIM_BOOL, TY154423) (Streamobj154418* s0);
typedef N_NIMCALL_PTR(void, TY154427) (Streamobj154418* s0, NI pos0);
typedef N_NIMCALL_PTR(NI, TY154432) (Streamobj154418* s0);
typedef N_NIMCALL_PTR(NI, TY154436) (Streamobj154418* s0, void* buffer0, NI buflen0);
typedef N_NIMCALL_PTR(NI, TY154442) (Streamobj154418* s0, void* buffer0, NI buflen0);
typedef N_NIMCALL_PTR(void, TY154448) (Streamobj154418* s0, void* buffer0, NI buflen0);
typedef N_NIMCALL_PTR(void, TY154454) (Streamobj154418* s0);
struct  Streamobj154418  {
  TNimObject Sup;
TY154419 closeimpl;
TY154423 atendimpl;
TY154427 setpositionimpl;
TY154432 getpositionimpl;
TY154436 readdataimpl;
TY154442 peekdataimpl;
TY154448 writedataimpl;
TY154454 flushimpl;
};
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef NU8 Filemode12409;
struct  Filestreamobj155477  {
  Streamobj154418 Sup;
FILE* f;
};
struct  Exception  {
  TNimObject Sup;
Exception* parent;
NCSTRING name;
NimStringDesc* message;
NimStringDesc* trace;
};
typedef struct {
N_NIMCALL_PTR(NIM_BOOL, ClPrc) (Exception* e0, void* ClEnv);
void* ClEnv;
} TY18011;
struct  TSafePoint  {
TSafePoint* prev;
NI status;
jmp_buf context;
NIM_BOOL hasRaiseAction;
TY18011 raiseAction;
};
struct  Systemerror3426  {
  Exception Sup;
};
struct  Ioerror3428  {
  Systemerror3426 Sup;
};
struct  Cell47704  {
NI refcount;
TNimType* typ;
};
struct  Cellseq47720  {
NI len;
NI cap;
Cell47704** d;
};
typedef Smallchunk29839* TY29900[512];
typedef Trunk29810* Trunkbuckets29812[256];
struct  Intset29814  {
Trunkbuckets29812 data;
};
struct  Memregion29885  {
NI minlargeobj;
NI maxlargeobj;
TY29900 freesmallchunks;
Llchunk29879* llmem;
NI currmem;
NI maxmem;
NI freemem;
NI lastsize;
Bigchunk29841* freechunkslist;
Intset29814 chunkstarts;
Avlnode29883* root;
Avlnode29883* deleted;
Avlnode29883* last;
Avlnode29883* freeavlnodes;
NIM_BOOL locked;
};
struct  Gcstat50214  {
NI stackscans;
NI cyclecollections;
NI maxthreshold;
NI maxstacksize;
NI maxstackcells;
NI cycletablesize;
NI64 maxpause;
};
struct  Cellset47716  {
NI counter;
NI max;
Pagedesc47712* head;
Pagedesc47712** data;
};
struct  Gcheap50218  {
Gcstack50216* stack;
void* stackbottom;
NI cyclethreshold;
Cellseq47720 zct;
Cellseq47720 decstack;
Cellseq47720 tempstack;
NI recgclock;
Memregion29885 region;
Gcstat50214 stat;
Cellset47716 marked;
Cellseq47720 additionalroots;
};
struct  Stringstreamobj155377  {
  Streamobj154418 Sup;
NimStringDesc* data;
NI pos;
};
struct  Gcstack50216  {
Gcstack50216* prev;
Gcstack50216* next;
void* starts;
void* pos;
NI maxstacksize;
};
struct  Basechunk29837  {
NI prevsize;
NI size;
NIM_BOOL used;
};
struct  Smallchunk29839  {
  Basechunk29837 Sup;
Smallchunk29839* next;
Smallchunk29839* prev;
Freecell29829* freelist;
NI free;
NI acc;
NF data;
};
struct  Llchunk29879  {
NI size;
NI acc;
Llchunk29879* next;
};
struct  Bigchunk29841  {
  Basechunk29837 Sup;
Bigchunk29841* next;
Bigchunk29841* prev;
NI align;
NF data;
};
typedef NI TY29818[16];
struct  Trunk29810  {
Trunk29810* next;
NI key;
TY29818 bits;
};
typedef Avlnode29883* TY29890[2];
struct  Avlnode29883  {
TY29890 link;
NI key;
NI upperbound;
NI level;
};
struct  Pagedesc47712  {
Pagedesc47712* next;
NI key;
TY29818 bits;
};
struct  Freecell29829  {
Freecell29829* next;
NI zerofield;
};
N_NIMCALL(void, TMP2984)(void* p, NI op);
N_NIMCALL(NIM_BOOL, open_15603_1689653243)(FILE** f0, NimStringDesc* filename0, Filemode12409 mode0, NI bufsize0);
N_NIMCALL(Filestreamobj155477*, newfilestream_155530_1780494535)(FILE* f0);
N_NIMCALL(void, TMP2985)(void* p, NI op);
N_NIMCALL(void*, newObj)(TNimType* typ0, NI size0);
N_NIMCALL(void, fsclose_155482_1780494535)(Streamobj154418* s0);
N_NIMCALL(NIM_BOOL, fsatend_155500_1780494535)(Streamobj154418* s0);
N_NIMCALL(NIM_BOOL, endoffile_15654_1689653243)(FILE* f0);
N_NIMCALL(void, fssetposition_155504_1780494535)(Streamobj154418* s0, NI pos0);
N_NIMCALL(void, setfilepos_15781_1689653243)(FILE* f0, NI64 pos0);
N_NIMCALL(NI, fsgetposition_155508_1780494535)(Streamobj154418* s0);
N_NIMCALL(NI64, getfilepos_15785_1689653243)(FILE* f0);
N_NIMCALL(NI, fsreaddata_155512_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0);
N_NIMCALL(NI, readbuffer_15754_1689653243)(FILE* f0, void* buffer0, NI len0);
N_NIMCALL(NI, fspeekdata_155518_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0);
static N_INLINE(void, pushSafePoint)(TSafePoint* s0);
static N_INLINE(void, popSafePoint)(void);
N_NIMCALL(void, reraiseException)(void);
N_NIMCALL(void, fswritedata_155525_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0);
N_NIMCALL(NI, writebuffer_15776_1689653243)(FILE* f0, void* buffer0, NI len0);
N_NIMCALL(Ioerror3428*, neweio_154402_1780494535)(NimStringDesc* msg0);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src0);
static N_INLINE(void, nimGCunrefNoCycle)(void* p0);
static N_INLINE(Cell47704*, usrtocell_51840_1689653243)(void* usr0);
static N_INLINE(void, rtladdzct_53001_1689653243)(Cell47704* c0);
N_NOINLINE(void, addzct_51817_1689653243)(Cellseq47720* s0, Cell47704* c0);
N_NIMCALL(void, raiseException)(Exception* e0, NCSTRING ename0);
N_NIMCALL(void, fsflush_155497_1780494535)(Streamobj154418* s0);
N_NIMCALL(void, writedata_154550_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* src0);
N_NIMCALL(NIM_CHAR, readchar_154854_1780494535)(Streamobj154418* s0);
N_NIMCALL(NI, readdata_154512_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* s0, NIM_CHAR c0);
N_NIMCALL(void, nimGCvisit)(void* d0, NI op0);
N_NIMCALL(void, TMP3271)(void* p, NI op);
N_NIMCALL(void, ssclose_155458_1780494535)(Streamobj154418* s_155460_1780494535);
N_NIMCALL(NIM_BOOL, ssatend_155383_1780494535)(Streamobj154418* s_155385_1780494535);
N_NIMCALL(void, sssetposition_155388_1780494535)(Streamobj154418* s_155390_1780494535, NI pos0);
N_NIMCALL(NI, clamp_155394_1689653243)(NI x0, NI a0, NI b0);
N_NIMCALL(NI, ssgetposition_155404_1780494535)(Streamobj154418* s_155406_1780494535);
N_NIMCALL(NI, ssreaddata_155409_1780494535)(Streamobj154418* s_155411_1780494535, void* buffer0, NI buflen0);
N_NIMCALL(NI, sspeekdata_155430_1780494535)(Streamobj154418* s_155432_1780494535, void* buffer0, NI buflen0);
N_NIMCALL(void, sswritedata_155442_1780494535)(Streamobj154418* s_155444_1780494535, void* buffer0, NI buflen0);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* s0, NI newlen0);
N_NIMCALL(NimStringDesc*, mnewString)(NI len0);
N_NIMCALL(NimStringDesc*, mnewString)(NI len0);
STRING_LITERAL(TMP2989, "cannot write to stream", 22);
STRING_LITERAL(TMP3227, "", 0);
extern TNimType NTI3408; /* RootObj */
TNimType NTI154418; /* StreamObj */
TNimType NTI154419; /* proc (s: Stream){.gcsafe.} */
TNimType NTI154423; /* proc (s: Stream): bool{.gcsafe.} */
TNimType NTI154427; /* proc (s: Stream, pos: int){.gcsafe.} */
TNimType NTI154432; /* proc (s: Stream): int{.gcsafe.} */
TNimType NTI154436; /* proc (s: Stream, buffer: pointer, bufLen: int): int{.gcsafe.} */
TNimType NTI154442; /* proc (s: Stream, buffer: pointer, bufLen: int): int{.gcsafe.} */
TNimType NTI154448; /* proc (s: Stream, buffer: pointer, bufLen: int){.gcsafe.} */
TNimType NTI154454; /* proc (s: Stream){.gcsafe.} */
TNimType NTI154416; /* Stream */
TNimType NTI155477; /* FileStreamObj */
extern TNimType NTI12407; /* File */
TNimType NTI155475; /* FileStream */
extern TSafePoint* exchandler_19637_1689653243;
extern TNimType NTI81079; /* ref IOError */
extern TNimType NTI3428; /* IOError */
extern Gcheap50218 gch_50258_1689653243;
TNimType NTI155377; /* StringStreamObj */
extern TNimType NTI138; /* string */
extern TNimType NTI104; /* int */
TNimType NTI155375; /* StringStream */
N_NIMCALL(void, TMP2984)(void* p, NI op) {
	Streamobj154418* a;
	a = (Streamobj154418*)p;
}

N_NIMCALL(NI, readdata_154512_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0) {
	NI result0;
	result0 = (NI)0;
	result0 = (*s0).readdataimpl(s0, buffer0, buflen0);
	return result0;
}
N_NIMCALL(void, TMP2985)(void* p, NI op) {
	Filestreamobj155477* a;
	a = (Filestreamobj155477*)p;
}

N_NIMCALL(void, fsclose_155482_1780494535)(Streamobj154418* s0) {
	{
		if (!!(((*((Filestreamobj155477*) (s0))).f == NIM_NIL))) goto LA3;
		fclose((*((Filestreamobj155477*) (s0))).f);
		(*((Filestreamobj155477*) (s0))).f = NIM_NIL;
	}
	LA3: ;
}

N_NIMCALL(NIM_BOOL, fsatend_155500_1780494535)(Streamobj154418* s0) {
	NIM_BOOL result0;
{	result0 = (NIM_BOOL)0;
	result0 = endoffile_15654_1689653243((*((Filestreamobj155477*) (s0))).f);
	goto BeforeRet;
	}BeforeRet: ;
	return result0;
}

N_NIMCALL(void, fssetposition_155504_1780494535)(Streamobj154418* s0, NI pos0) {
	setfilepos_15781_1689653243((*((Filestreamobj155477*) (s0))).f, ((NI64) (pos0)));
}

N_NIMCALL(NI, fsgetposition_155508_1780494535)(Streamobj154418* s0) {
	NI result0;
	NI64 LOC1;
{	result0 = (NI)0;
	LOC1 = (NI64)0;
	LOC1 = getfilepos_15785_1689653243((*((Filestreamobj155477*) (s0))).f);
	result0 = ((NI) (LOC1));
	goto BeforeRet;
	}BeforeRet: ;
	return result0;
}

N_NIMCALL(NI, fsreaddata_155512_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0) {
	NI result0;
	result0 = (NI)0;
	result0 = readbuffer_15754_1689653243((*((Filestreamobj155477*) (s0))).f, buffer0, ((NI) (buflen0)));
	return result0;
}

static N_INLINE(void, pushSafePoint)(TSafePoint* s0) {
	(*s0).hasRaiseAction = NIM_FALSE;
	(*s0).prev = exchandler_19637_1689653243;
	exchandler_19637_1689653243 = s0;
}

static N_INLINE(void, popSafePoint)(void) {
	exchandler_19637_1689653243 = (*exchandler_19637_1689653243).prev;
}

N_NIMCALL(NI, fspeekdata_155518_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0) {
	NI volatile result0;
	NI pos0;
	TSafePoint TMP2988;
	result0 = (NI)0;
	pos0 = fsgetposition_155508_1780494535(s0);
	pushSafePoint(&TMP2988);
	TMP2988.status = setjmp(TMP2988.context);
	if (TMP2988.status == 0) {
		result0 = readbuffer_15754_1689653243((*((Filestreamobj155477*) (s0))).f, buffer0, ((NI) (buflen0)));
		popSafePoint();
	}
	else {
		popSafePoint();
	}
	{
		fssetposition_155504_1780494535(s0, pos0);
	}
	if (TMP2988.status != 0) reraiseException();
	return result0;
}

static N_INLINE(Cell47704*, usrtocell_51840_1689653243)(void* usr0) {
	Cell47704* result0;
	result0 = (Cell47704*)0;
	result0 = ((Cell47704*) ((NI)((NU32)(((NI) (usr0))) - (NU32)(((NI)sizeof(Cell47704))))));
	return result0;
}

static N_INLINE(void, rtladdzct_53001_1689653243)(Cell47704* c0) {
	addzct_51817_1689653243((&gch_50258_1689653243.zct), c0);
}

static N_INLINE(void, nimGCunrefNoCycle)(void* p0) {
	Cell47704* c0;
	c0 = usrtocell_51840_1689653243(p0);
	{
		(*c0).refcount -= ((NI) 8);
		if (!((NU32)((*c0).refcount) < (NU32)(((NI) 8)))) goto LA3;
		rtladdzct_53001_1689653243(c0);
	}
	LA3: ;
}

N_NIMCALL(Ioerror3428*, neweio_154402_1780494535)(NimStringDesc* msg0) {
	Ioerror3428* result0;
	NimStringDesc* LOC1;
	result0 = (Ioerror3428*)0;
	result0 = (Ioerror3428*) newObj((&NTI81079), sizeof(Ioerror3428));
	(*result0).Sup.Sup.Sup.m_type = (&NTI3428);
	LOC1 = (NimStringDesc*)0;
	LOC1 = (*result0).Sup.Sup.message; (*result0).Sup.Sup.message = copyStringRC1(msg0);
	if (LOC1) nimGCunrefNoCycle(LOC1);
	return result0;
}

N_NIMCALL(void, fswritedata_155525_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0) {
	{
		NI LOC3;
		Ioerror3428* LOC6;
		LOC3 = (NI)0;
		LOC3 = writebuffer_15776_1689653243((*((Filestreamobj155477*) (s0))).f, buffer0, ((NI) (buflen0)));
		if (!!((LOC3 == buflen0))) goto LA4;
		LOC6 = (Ioerror3428*)0;
		LOC6 = neweio_154402_1780494535(((NimStringDesc*) &TMP2989));
		raiseException((Exception*)LOC6, "IOError");
	}
	LA4: ;
}

N_NIMCALL(void, fsflush_155497_1780494535)(Streamobj154418* s0) {
	fflush((*((Filestreamobj155477*) (s0))).f);
}

N_NIMCALL(Filestreamobj155477*, newfilestream_155530_1780494535)(FILE* f0) {
	Filestreamobj155477* result0;
	result0 = (Filestreamobj155477*)0;
	result0 = (Filestreamobj155477*) newObj((&NTI155475), sizeof(Filestreamobj155477));
	(*result0).Sup.Sup.m_type = (&NTI155477);
	(*result0).f = f0;
	(*result0).Sup.closeimpl = fsclose_155482_1780494535;
	(*result0).Sup.atendimpl = fsatend_155500_1780494535;
	(*result0).Sup.setpositionimpl = fssetposition_155504_1780494535;
	(*result0).Sup.getpositionimpl = fsgetposition_155508_1780494535;
	(*result0).Sup.readdataimpl = fsreaddata_155512_1780494535;
	(*result0).Sup.peekdataimpl = fspeekdata_155518_1780494535;
	(*result0).Sup.writedataimpl = fswritedata_155525_1780494535;
	(*result0).Sup.flushimpl = fsflush_155497_1780494535;
	return result0;
}

N_NIMCALL(Filestreamobj155477*, newfilestream_155542_1780494535)(NimStringDesc* filename0, Filemode12409 mode0) {
	Filestreamobj155477* result0;
	FILE* f0;
	result0 = (Filestreamobj155477*)0;
	f0 = (FILE*)0;
	{
		NIM_BOOL LOC3;
		LOC3 = (NIM_BOOL)0;
		LOC3 = open_15603_1689653243(&f0, filename0, mode0, ((NI) -1));
		if (!LOC3) goto LA4;
		result0 = newfilestream_155530_1780494535(f0);
	}
	LA4: ;
	return result0;
}

N_NIMCALL(void, close_154471_1780494535)(Streamobj154418* s0) {
	{
		if (!!((*s0).closeimpl == 0)) goto LA3;
		(*s0).closeimpl(s0);
	}
	LA3: ;
}

N_NIMCALL(void, writedata_154550_1780494535)(Streamobj154418* s0, void* buffer0, NI buflen0) {
	(*s0).writedataimpl(s0, buffer0, buflen0);
}

N_NIMCALL(void, write_154570_1780494535)(Streamobj154418* s0, NimStringDesc* x0) {
	{
		if (!(((NI) 0) < (x0 ? x0->Sup.len : 0))) goto LA3;
		writedata_154550_1780494535(s0, ((void*) ((&x0->data[((NI) 0)]))), (x0 ? x0->Sup.len : 0));
	}
	LA3: ;
}

N_NIMCALL(NIM_BOOL, atend_154485_1780494535)(Streamobj154418* s0) {
	NIM_BOOL result0;
	result0 = (NIM_BOOL)0;
	result0 = (*s0).atendimpl(s0);
	return result0;
}

N_NIMCALL(NIM_CHAR, readchar_154854_1780494535)(Streamobj154418* s0) {
	NIM_CHAR result0;
	result0 = (NIM_CHAR)0;
	{
		NI LOC3;
		LOC3 = (NI)0;
		LOC3 = readdata_154512_1780494535(s0, ((void*) ((&result0))), ((NI) 1));
		if (!!((LOC3 == ((NI) 1)))) goto LA4;
		result0 = 0;
	}
	LA4: ;
	return result0;
}

N_NIMCALL(NimStringDesc*, readline_155361_1780494535)(Streamobj154418* s0) {
	NimStringDesc* result0;
	result0 = (NimStringDesc*)0;
	result0 = copyString(((NimStringDesc*) &TMP3227));
	{
		while (1) {
			NIM_CHAR c0;
			c0 = readchar_154854_1780494535(s0);
			{
				if (!((NU8)(c0) == (NU8)(13))) goto LA5;
				c0 = readchar_154854_1780494535(s0);
				goto LA1;
			}
			LA5: ;
			{
				NIM_BOOL LOC9;
				LOC9 = (NIM_BOOL)0;
				LOC9 = ((NU8)(c0) == (NU8)(10));
				if (LOC9) goto LA10;
				LOC9 = ((NU8)(c0) == (NU8)(0));
				LA10: ;
				if (!LOC9) goto LA11;
				goto LA1;
			}
			goto LA7;
			LA11: ;
			{
				result0 = addChar(result0, c0);
			}
			LA7: ;
		}
	} LA1: ;
	return result0;
}
N_NIMCALL(void, TMP3271)(void* p, NI op) {
	Stringstreamobj155377* a;
	a = (Stringstreamobj155377*)p;
	nimGCvisit((void*)(*a).data, op);
}

N_NIMCALL(void, ssclose_155458_1780494535)(Streamobj154418* s_155460_1780494535) {
	Stringstreamobj155377* s0;
	NimStringDesc* LOC1;
	s0 = ((Stringstreamobj155377*) (s_155460_1780494535));
	LOC1 = (NimStringDesc*)0;
	LOC1 = (*s0).data; (*s0).data = copyStringRC1(NIM_NIL);
	if (LOC1) nimGCunrefNoCycle(LOC1);
}

N_NIMCALL(NIM_BOOL, ssatend_155383_1780494535)(Streamobj154418* s_155385_1780494535) {
	NIM_BOOL result0;
	Stringstreamobj155377* s0;
{	result0 = (NIM_BOOL)0;
	s0 = ((Stringstreamobj155377*) (s_155385_1780494535));
	result0 = (((*s0).data ? (*s0).data->Sup.len : 0) <= (*s0).pos);
	goto BeforeRet;
	}BeforeRet: ;
	return result0;
}

N_NIMCALL(void, sssetposition_155388_1780494535)(Streamobj154418* s_155390_1780494535, NI pos0) {
	Stringstreamobj155377* s0;
	s0 = ((Stringstreamobj155377*) (s_155390_1780494535));
	(*s0).pos = clamp_155394_1689653243(pos0, ((NI) 0), ((*s0).data ? (*s0).data->Sup.len : 0));
}

N_NIMCALL(NI, ssgetposition_155404_1780494535)(Streamobj154418* s_155406_1780494535) {
	NI result0;
	Stringstreamobj155377* s0;
{	result0 = (NI)0;
	s0 = ((Stringstreamobj155377*) (s_155406_1780494535));
	result0 = (*s0).pos;
	goto BeforeRet;
	}BeforeRet: ;
	return result0;
}

N_NIMCALL(NI, ssreaddata_155409_1780494535)(Streamobj154418* s_155411_1780494535, void* buffer0, NI buflen0) {
	NI result0;
	Stringstreamobj155377* s0;
	result0 = (NI)0;
	s0 = ((Stringstreamobj155377*) (s_155411_1780494535));
	result0 = ((buflen0 <= (NI)(((*s0).data ? (*s0).data->Sup.len : 0) - (*s0).pos)) ? buflen0 : (NI)(((*s0).data ? (*s0).data->Sup.len : 0) - (*s0).pos));
	{
		if (!(((NI) 0) < result0)) goto LA3;
		memcpy(buffer0, ((void*) ((&(*s0).data->data[(*s0).pos]))), ((NI) (result0)));
		(*s0).pos += result0;
	}
	LA3: ;
	return result0;
}

N_NIMCALL(NI, sspeekdata_155430_1780494535)(Streamobj154418* s_155432_1780494535, void* buffer0, NI buflen0) {
	NI result0;
	Stringstreamobj155377* s0;
	result0 = (NI)0;
	s0 = ((Stringstreamobj155377*) (s_155432_1780494535));
	result0 = ((buflen0 <= (NI)(((*s0).data ? (*s0).data->Sup.len : 0) - (*s0).pos)) ? buflen0 : (NI)(((*s0).data ? (*s0).data->Sup.len : 0) - (*s0).pos));
	{
		if (!(((NI) 0) < result0)) goto LA3;
		memcpy(buffer0, ((void*) ((&(*s0).data->data[(*s0).pos]))), ((NI) (result0)));
	}
	LA3: ;
	return result0;
}

N_NIMCALL(void, sswritedata_155442_1780494535)(Streamobj154418* s_155444_1780494535, void* buffer0, NI buflen0) {
	Stringstreamobj155377* s0;
{	s0 = ((Stringstreamobj155377*) (s_155444_1780494535));
	{
		if (!(buflen0 <= ((NI) 0))) goto LA3;
		goto BeforeRet;
	}
	LA3: ;
	{
		if (!(((*s0).data ? (*s0).data->Sup.len : 0) < (NI)((*s0).pos + buflen0))) goto LA7;
		(*s0).data = setLengthStr((*s0).data, ((NI) ((NI)((*s0).pos + buflen0))));
	}
	LA7: ;
	memcpy(((void*) ((&(*s0).data->data[(*s0).pos]))), buffer0, ((NI) (buflen0)));
	(*s0).pos += buflen0;
	}BeforeRet: ;
}

N_NIMCALL(Stringstreamobj155377*, newstringstream_155462_1780494535)(NimStringDesc* s0) {
	Stringstreamobj155377* result0;
	NimStringDesc* LOC1;
	result0 = (Stringstreamobj155377*)0;
	result0 = (Stringstreamobj155377*) newObj((&NTI155375), sizeof(Stringstreamobj155377));
	(*result0).Sup.Sup.m_type = (&NTI155377);
	LOC1 = (NimStringDesc*)0;
	LOC1 = (*result0).data; (*result0).data = copyStringRC1(s0);
	if (LOC1) nimGCunrefNoCycle(LOC1);
	(*result0).pos = ((NI) 0);
	(*result0).Sup.closeimpl = ssclose_155458_1780494535;
	(*result0).Sup.atendimpl = ssatend_155383_1780494535;
	(*result0).Sup.setpositionimpl = sssetposition_155388_1780494535;
	(*result0).Sup.getpositionimpl = ssgetposition_155404_1780494535;
	(*result0).Sup.readdataimpl = ssreaddata_155409_1780494535;
	(*result0).Sup.peekdataimpl = sspeekdata_155430_1780494535;
	(*result0).Sup.writedataimpl = sswritedata_155442_1780494535;
	return result0;
}

N_NIMCALL(NimStringDesc*, readall_154518_1780494535)(Streamobj154418* s0) {
	NimStringDesc* result0;
	NI r0;
	result0 = (NimStringDesc*)0;
	result0 = mnewString(((NI) 1000));
	r0 = ((NI) 0);
	{
		while (1) {
			NI readbytes0;
			readbytes0 = readdata_154512_1780494535(s0, ((void*) ((&result0->data[r0]))), ((NI) 1000));
			{
				if (!(readbytes0 < ((NI) 1000))) goto LA5;
				result0 = setLengthStr(result0, ((NI) ((NI)(r0 + readbytes0))));
				goto LA1;
			}
			LA5: ;
			r0 += ((NI) 1000);
			result0 = setLengthStr(result0, ((NI) ((NI)(r0 + ((NI) 1000)))));
		}
	} LA1: ;
	return result0;
}
NIM_EXTERNC N_NOINLINE(void, stdlib_streamsInit000)(void) {
}

NIM_EXTERNC N_NOINLINE(void, stdlib_streamsDatInit000)(void) {
static TNimNode* TMP2983[8];
static TNimNode* TMP3270[2];
static TNimNode TMP45[13];
NTI154418.size = sizeof(Streamobj154418);
NTI154418.kind = 17;
NTI154418.base = (&NTI3408);
NTI154418.flags = 1;
TMP2983[0] = &TMP45[1];
NTI154419.size = sizeof(TY154419);
NTI154419.kind = 25;
NTI154419.base = 0;
NTI154419.flags = 3;
TMP45[1].kind = 1;
TMP45[1].offset = offsetof(Streamobj154418, closeimpl);
TMP45[1].typ = (&NTI154419);
TMP45[1].name = "closeImpl";
TMP2983[1] = &TMP45[2];
NTI154423.size = sizeof(TY154423);
NTI154423.kind = 25;
NTI154423.base = 0;
NTI154423.flags = 3;
TMP45[2].kind = 1;
TMP45[2].offset = offsetof(Streamobj154418, atendimpl);
TMP45[2].typ = (&NTI154423);
TMP45[2].name = "atEndImpl";
TMP2983[2] = &TMP45[3];
NTI154427.size = sizeof(TY154427);
NTI154427.kind = 25;
NTI154427.base = 0;
NTI154427.flags = 3;
TMP45[3].kind = 1;
TMP45[3].offset = offsetof(Streamobj154418, setpositionimpl);
TMP45[3].typ = (&NTI154427);
TMP45[3].name = "setPositionImpl";
TMP2983[3] = &TMP45[4];
NTI154432.size = sizeof(TY154432);
NTI154432.kind = 25;
NTI154432.base = 0;
NTI154432.flags = 3;
TMP45[4].kind = 1;
TMP45[4].offset = offsetof(Streamobj154418, getpositionimpl);
TMP45[4].typ = (&NTI154432);
TMP45[4].name = "getPositionImpl";
TMP2983[4] = &TMP45[5];
NTI154436.size = sizeof(TY154436);
NTI154436.kind = 25;
NTI154436.base = 0;
NTI154436.flags = 3;
TMP45[5].kind = 1;
TMP45[5].offset = offsetof(Streamobj154418, readdataimpl);
TMP45[5].typ = (&NTI154436);
TMP45[5].name = "readDataImpl";
TMP2983[5] = &TMP45[6];
NTI154442.size = sizeof(TY154442);
NTI154442.kind = 25;
NTI154442.base = 0;
NTI154442.flags = 3;
TMP45[6].kind = 1;
TMP45[6].offset = offsetof(Streamobj154418, peekdataimpl);
TMP45[6].typ = (&NTI154442);
TMP45[6].name = "peekDataImpl";
TMP2983[6] = &TMP45[7];
NTI154448.size = sizeof(TY154448);
NTI154448.kind = 25;
NTI154448.base = 0;
NTI154448.flags = 3;
TMP45[7].kind = 1;
TMP45[7].offset = offsetof(Streamobj154418, writedataimpl);
TMP45[7].typ = (&NTI154448);
TMP45[7].name = "writeDataImpl";
TMP2983[7] = &TMP45[8];
NTI154454.size = sizeof(TY154454);
NTI154454.kind = 25;
NTI154454.base = 0;
NTI154454.flags = 3;
TMP45[8].kind = 1;
TMP45[8].offset = offsetof(Streamobj154418, flushimpl);
TMP45[8].typ = (&NTI154454);
TMP45[8].name = "flushImpl";
TMP45[0].len = 8; TMP45[0].kind = 2; TMP45[0].sons = &TMP2983[0];
NTI154418.node = &TMP45[0];
NTI154416.size = sizeof(Streamobj154418*);
NTI154416.kind = 22;
NTI154416.base = (&NTI154418);
NTI154416.marker = TMP2984;
NTI155477.size = sizeof(Filestreamobj155477);
NTI155477.kind = 17;
NTI155477.base = (&NTI154418);
NTI155477.flags = 1;
TMP45[9].kind = 1;
TMP45[9].offset = offsetof(Filestreamobj155477, f);
TMP45[9].typ = (&NTI12407);
TMP45[9].name = "f";
NTI155477.node = &TMP45[9];
NTI155475.size = sizeof(Filestreamobj155477*);
NTI155475.kind = 22;
NTI155475.base = (&NTI155477);
NTI155475.marker = TMP2985;
NTI155377.size = sizeof(Stringstreamobj155377);
NTI155377.kind = 17;
NTI155377.base = (&NTI154418);
TMP3270[0] = &TMP45[11];
TMP45[11].kind = 1;
TMP45[11].offset = offsetof(Stringstreamobj155377, data);
TMP45[11].typ = (&NTI138);
TMP45[11].name = "data";
TMP3270[1] = &TMP45[12];
TMP45[12].kind = 1;
TMP45[12].offset = offsetof(Stringstreamobj155377, pos);
TMP45[12].typ = (&NTI104);
TMP45[12].name = "pos";
TMP45[10].len = 2; TMP45[10].kind = 2; TMP45[10].sons = &TMP3270[0];
NTI155377.node = &TMP45[10];
NTI155375.size = sizeof(Stringstreamobj155377*);
NTI155375.kind = 22;
NTI155375.base = (&NTI155377);
NTI155375.marker = TMP3271;
}

